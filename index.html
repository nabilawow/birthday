<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Birthday Surprise</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background-color: #0a0a0a;
      color: #ffc6fc;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }

    .popup {
      background-color: #1a1a1a;
      padding: 2rem;
      border-radius: 20px;
      box-shadow: 0 0 20px #ff80d5;
      text-align: center;
    }

    h2, h3, p {
      margin: 1rem 0;
    }

    .hidden {
      display: none;
    }

    .reward-images img {
      width: 70px;
      height: auto;
      margin: 0 10px;
      border-radius: 10px;
      box-shadow: 0 0 10px #ff8bd2;
      background: #fff;
    }

    button {
      margin: 10px;
      padding: 10px 20px;
      border-radius: 8px;
      border: none;
      background-color: #ff80d5;
      color: white;
      font-size: 1rem;
      cursor: pointer;
    }

    .game-wrapper {
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 1rem;
    }

    #canvas-holder {
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 0 30px rgba(255, 200, 255, 0.5);
      max-width: 100%;
    }
  </style>
</head>
<body>

  <div class="popup" id="introPopup">
    <h2>Enjoy your gifts</h2>
    <button onclick="showGameContainer()">Let's play a game first</button>
  </div>

  <div class="game-wrapper hidden" id="gameContainer">
    <div class="popup">
      <h3>Collect 10 cakes to complete</h3>
      <div id="canvas-holder"></div>
    </div>
  </div>

  <div class="popup hidden" id="rewardContainer">
    <h2>Enjoy your gifts</h2>
    <div class="reward-images">
      <img src="candy.png" alt="Left Gift" />
      <img src="luv.png" alt="Center Gift" />
      <img src="cake.png" alt="Right Gift" />
    </div>
    <p style="font-style: italic;">Shall the wishes you write do come true one day</p>
  </div>

  <audio id="birthdaySong" preload="auto">
    <source src="bubblegum.mp3" type="audio/mpeg" />
  </audio>

  <script src="https://cdn.jsdelivr.net/npm/p5@1.6.0/lib/p5.min.js"></script>

  <script>
    let cakes = [];
    let player;
    let cakeImg, playerImg;
    let score = 0;
    const goal = 10;

    function preload() {
      cakeImg = loadImage('cake.png');
      playerImg = loadImage('luv.png'); 
    }

    function setup() {
      let canvas = createCanvas(300, 500);
      canvas.parent('canvas-holder');
      resetGame();
    }

    function draw() {
      background('#ffd6ea');

      image(playerImg, player.x, player.y, 50, 50);

      for (let i = cakes.length - 1; i >= 0; i--) {
        let cake = cakes[i];
        cake.y += cake.speed;
        image(cakeImg, cake.x, cake.y, 40, 40);

        if (dist(cake.x, cake.y, player.x, player.y) < 40) {
          cakes.splice(i, 1);
          score++;
        }

        if (cake.y > height) {
          cakes.splice(i, 1);
        }
      }

      fill('#ff0080');
      textSize(14);
      text(`Cakes: ${score} / ${goal}`, 10, 20);

      if (score >= goal) {
        noLoop();
        document.getElementById('gameContainer').classList.add('hidden');
        document.getElementById('rewardContainer').classList.remove('hidden');
        document.getElementById('birthdaySong').play();
      }
    }

    function keyPressed() {
      if (keyCode === LEFT_ARROW && player.x > 0) {
        player.x -= 20;
      } else if (keyCode === RIGHT_ARROW && player.x < width - 50) {
        player.x += 20;
      }
    }

    function resetGame() {
      score = 0;
      cakes = [];
      player = { x: width / 2 - 25, y: height - 60 };

      setInterval(() => {
        cakes.push({
          x: random(20, width - 60),
          y: -40,
          speed: random(2, 4)
        });
      }, 800);
    }

    function showGameContainer() {
      document.getElementById('introPopup').classList.add('hidden');
      document.getElementById('gameContainer').classList.remove('hidden');
    }
  </script>
</body>
</html>
